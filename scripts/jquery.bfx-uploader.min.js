/*!
 * Panda uploader v1.4.0
 * http://pandastream.com/
 *
 * Copyright 2010, New Bamboo
 * Released under the MIT licence.
 * This library contains code with the following licences:
 *
 * SWFUpload: http://www.swfupload.org, http://swfupload.googlecode.com
 *
 * mmSWFUpload 1.0: Flash upload dialog - http://profandesign.se/swfupload/,  http://www.vinterwebb.se/
 *
 * SWFUpload is (c) 2006-2007 Lars Huring, Olov NilzÃ©n and Mammon Media and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * SWFUpload 2 is (c) 2007-2008 Jake Roberts and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * SWFUpload jQuery Plugin v1.0.0
 *
 *   Copyright (c) 2009 Adam Royle
 *   Licensed under the MIT license.
*/

var SWFUpload;SWFUpload==void 0&&(SWFUpload=function(a){this.initSWFUpload(a)});SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(a){if(typeof a!=="string"||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=window.location.pathname.lastIndexOf("/");path=b<=0?"/":window.location.pathname.substr(0,b)+"/";return path+a};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=this.settings[a]==void 0?b:this.settings[a]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",!1);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",!1);this.ensureDefault("requeue_on_error",!1);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types",
"*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",!0);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",!1);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",!1);this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",
null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching)this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime();if(!this.settings.preserve_relative_urls)this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=
SWFUpload.completeURL(this.settings.button_image_url);delete this.ensureDefault};
SWFUpload.prototype.loadFlash=function(){var a,b;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(a==void 0)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div");b.innerHTML=this.getFlashHTML();a.parentNode.replaceChild(b.firstChild,a);window[this.movieName]==
void 0&&(window[this.movieName]=this.getMovieElement())};SWFUpload.prototype.getIEFlashAttributes=function(){return navigator.appName=="Microsoft Internet Explorer"?' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':""};
SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'"',this.getIEFlashAttributes(),' width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload"><param name="wmode" value="',this.settings.button_window_mode,'" /><param name="movie" value="',this.settings.flash_url,'" /><param name="quality" value="high" /><param name="menu" value="false" /><param name="allowScriptAccess" value="always" />',
'<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};
SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),
"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),
"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),
"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==void 0)this.movieElement=document.getElementById(this.movieName);if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement};
SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if(typeof a==="object")for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")};
SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var a=null;if((a=this.getMovieElement())&&typeof a.CallFunction==="unknown"){for(var b in a)try{typeof a[b]==="function"&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieName=this.eventQueue=this.customSettings=this.settings=this.movieElement=null;return!0}catch(e){return!1}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\nVersion: ",SWFUpload.version,"\nMovie Name: ",this.movieName,"\nSettings:\n\tupload_url:               ",this.settings.upload_url,"\n\tflash_url:                ",this.settings.flash_url,"\n\tuse_query_string:         ",this.settings.use_query_string.toString(),"\n\trequeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n\thttp_success:             ",this.settings.http_success.join(", "),"\n\tassume_success_timeout:   ",
this.settings.assume_success_timeout,"\n\tfile_post_name:           ",this.settings.file_post_name,"\n\tpost_params:              ",this.settings.post_params.toString(),"\n\tfile_types:               ",this.settings.file_types,"\n\tfile_types_description:   ",this.settings.file_types_description,"\n\tfile_size_limit:          ",this.settings.file_size_limit,"\n\tfile_upload_limit:        ",this.settings.file_upload_limit,"\n\tfile_queue_limit:         ",this.settings.file_queue_limit,"\n\tdebug:                    ",
this.settings.debug.toString(),"\n\tprevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n\tbutton_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n\tbutton_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n\tbutton_image_url:         ",this.settings.button_image_url.toString(),"\n\tbutton_width:             ",this.settings.button_width.toString(),"\n\tbutton_height:            ",this.settings.button_height.toString(),"\n\tbutton_text:              ",
this.settings.button_text.toString(),"\n\tbutton_text_style:        ",this.settings.button_text_style.toString(),"\n\tbutton_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n\tbutton_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n\tbutton_action:            ",this.settings.button_action.toString(),"\n\tbutton_disabled:          ",this.settings.button_disabled.toString(),"\n\tcustom_settings:          ",this.settings.custom_settings.toString(),"\nEvent Handlers:\n\tswfupload_loaded_handler assigned:  ",
(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n\tfile_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n\tfile_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n\tfile_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n\tupload_start_handler assigned:      ",(typeof this.settings.upload_start_handler===
"function").toString(),"\n\tupload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n\tupload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n\tupload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n\tupload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n\tdebug_handler assigned:             ",
(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(a,b,c){return b==void 0?this.settings[a]=c:this.settings[a]=b};SWFUpload.prototype.getSetting=function(a){return this.settings[a]!=void 0?this.settings[a]:""};
SWFUpload.prototype.callFlash=function(a,b){var b=b||[],c=this.getMovieElement(),d,e;try{e=c.CallFunction('<invoke name="'+a+'" returntype="javascript">'+__flash__argumentsToXML(b,0)+"</invoke>"),d=eval(e)}catch(f){throw"Call to "+a+" failed";}d!=void 0&&typeof d.post==="object"&&(d=this.unescapeFilePostParams(d));return d};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};
SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a,b){b!==!1&&(b=!0);this.callFlash("CancelUpload",[a,b])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};
SWFUpload.prototype.getFile=function(a){return typeof a==="number"?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};
SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};
SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};
SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};
SWFUpload.prototype.setHTTPSuccess=function(a){typeof a==="string"&&(a=a.replace(" ","").split(","));this.settings.http_success=a;this.callFlash("SetHTTPSuccess",[a])};SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a;this.callFlash("SetAssumeSuccessTimeout",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};
SWFUpload.prototype.setButtonImageURL=function(a){a==void 0&&(a="");this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a;this.settings.button_height=b;var c=this.getMovieElement();if(c!=void 0)c.style.width=a+"px",c.style.height=b+"px";this.callFlash("SetButtonDimensions",[a,b])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};
SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b;this.settings.button_text_left_padding=a;this.callFlash("SetButtonTextPadding",[a,b])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};
SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a;this.callFlash("SetButtonCursor",[a])};
SWFUpload.prototype.queueEvent=function(a,b){b==void 0?b=[]:b instanceof Array||(b=[b]);var c=this;if(typeof this.settings[a]==="function")this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(this.settings[a]!==null)throw"Event handler "+a+" is unknown or is not a function";};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;typeof a==="function"&&a.apply(this)};
SWFUpload.prototype.unescapeFilePostParams=function(a){var b=/[$]([0-9a-f]{4})/i,c={},d;if(a!=void 0){for(var e in a.post)if(a.post.hasOwnProperty(e)){d=e;for(var f;(f=b.exec(d))!==null;)d=d.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));c[d]=a.post[e]}a.post=c}return a};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}};
SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();a?(this.cleanUp(a),this.queueEvent("swfupload_loaded_handler")):this.debug("Flash called back ready but the flash movie can't be found.")};
SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&typeof a.CallFunction==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{typeof a[b]==="function"&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};
SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,b,c])};SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};
SWFUpload.prototype.returnUploadStart=function(a){var b;if(typeof this.settings.upload_start_handler==="function")a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(this.settings.upload_start_handler!=void 0)throw"upload_start_handler must be a function";b===void 0&&(b=!0);this.callFlash("ReturnUploadStart",[!!b])};SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,b,c])};
SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,b,c])};SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_success_handler",[a,b,c])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)};
SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b=[];if(typeof a==="object"&&typeof a.name==="string"&&typeof a.message==="string"){for(var c in a)a.hasOwnProperty(c)&&b.push(c+": "+a[c]);a=b.join("\n")||"";b=a.split("\n");a="EXCEPTION: "+b.join("\nEXCEPTION: ")}SWFUpload.Console.writeLine(a)}};SWFUpload.Console={};
SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console");if(!b)c=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(c),b=document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b);b.value+=a+"\n";b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+
d.name+" Message: "+d.message)}};
(function(a){var b="swfupload_loaded_handler,file_queued_handler,file_queue_error_handler,file_dialog_start_handler,file_dialog_complete_handler,upload_start_handler,upload_progress_handler,upload_error_handler,upload_success_handler,upload_complete_handler,queue_complete_handler".split(","),c=[];a.fn.swfupload=function(){var d=a.makeArray(arguments);return this.each(function(){var e;if(d.length==1&&typeof d[0]=="object"){if(e=a(this).data("__swfu"),!e){var f=d[0],h=a(this);e=[];a.merge(e,b);a.merge(e,
c);a.each(e,function(b,c){var d=c.replace(/_handler$/,"").replace(/_([a-z])/g,function(a,b){return b.toUpperCase()});f[c]=function(){var b=a.Event(d);h.trigger(b,a.makeArray(arguments));return!b.isDefaultPrevented()}});a(this).data("__swfu",new SWFUpload(f))}}else if(d.length>0&&typeof d[0]=="string"){var g=d.shift();(e=a(this).data("__swfu"))&&e[g]&&e[g].apply(e,d)}})};a.swfupload={additionalHandlers:function(){if(arguments.length===0)return c.slice();else a(arguments).each(function(b,e){a.merge(c,
a.makeArray(e))})},defaultHandlers:function(){return b.slice()},getInstance:function(b){return a(b).data("__swfu")}}})(jQuery);function PandaUploader(){}PandaUploader.VERSION="1.4.0";PandaUploader.cdn_host="d21qbsp9m249bi.cloudfront.net";PandaUploader.uploader_dir="//"+PandaUploader.cdn_host+"/u/"+PandaUploader.VERSION;
PandaUploader.getHttpStatusText=function(a){return{400:"Bad Request",401:"Unauthorized",404:"Not Found",412:"Precondition Failed",415:"Unsupported Media Type",500:"Internal Server Error"}[a*1]};PandaUploader.getPandaError=function(a){return{400:"BadRequest",401:"NotAuthorized",404:"RecordNotFound",412:"CannotDelete",415:"FormatNotRecognised",500:"PandaError"}[a*1]};PandaUploader.supportFileAPI=function(){var a=document.createElement("INPUT");a.type="file";return"files"in a};
PandaUploader.supportAjaxUploadProgressEvents=function(){var a=PandaUploader.createXHRObject();return!(!a||!("upload"in a&&"onprogress"in a.upload))};PandaUploader.supportCORS=function(){return typeof XDomainRequest!="undefined"?!0:typeof XMLHttpRequest!="undefined"?"withCredentials"in new XMLHttpRequest:null};PandaUploader.supportFormData=function(){return typeof window.FormData!="undefined"?!0:null};
PandaUploader.supportHTML5Widget=function(){return PandaUploader.supportFileAPI()&&PandaUploader.supportFormData()&&PandaUploader.supportAjaxUploadProgressEvents()&&PandaUploader.supportCORS()};PandaUploader.hasFirefox=function(a){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&parseFloat(RegExp.$1)<=a?!0:!1};
PandaUploader.createXHRObject=function(){if(typeof this.XMLHttpFactories=="undefined")this.XMLHttpFactories=[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var a=null,b=0;b<this.XMLHttpFactories.length;b++){try{a=this.XMLHttpFactories[b]()}catch(c){continue}break}return a};
PandaUploader.bind=function(a,b){return function(){var c=a[b];if(c)return c.apply(a,arguments)}};PandaUploader.alert=function(a){return alert(a)};PandaUploader.log=function(){};PandaUploader.parseJSON=function(a){return jQuery&&jQuery.parseJSON?jQuery.parseJSON(a):eval("("+a+")")};PandaUploader.toJSON=function(a){var b=[];jQuery.each(a,function(a,d){b.push('"'+a.replace(RegExp('"',"g"),'\\"')+'":"'+d.replace(RegExp('"',"g"),'\\"')+'"')});return"{"+b.join(",")+"}"};
PandaUploader.sizeInBytes=function(a){if(!a)return 0;a=String(a).match(/([0-9]+)([GKM]?B?)?/);if(!a)return 0;var b=a[1],c=1;switch(a[2]){case "B":c=0;break;case "M":case "MB":c=2;break;case "G":case "GB":c=3}return b*Math.pow(1024,c)};PandaUploader.BaseWidget=function(){};
PandaUploader.BaseWidget.prototype={init:function(a,b,c){this.query=a;this.signed_params=b;this.options=c;this.upload_strategy=this.options.upload_strategy;this.upload_strategy.init()},triggerEvent:function(a,b){var c=this.upload_strategy[a];c&&(b||(b=[]),c.apply(this.upload_strategy,b));return this.triggerUserEvent(a,b)},triggerUserEvent:function(a,b){var c=this.options[a];if(c)return c.apply(window,b)},boundHandler:function(a){var b=PandaUploader.bind(this,"triggerEvent");return function(){b(a,
arguments)}},getSignedParams:function(){return this.signed_params.call?this.signed_params():this.signed_params},start:function(){throw"Unimplemented method start()";},disable:function(){throw"Unimplemented method disable()";},enable:function(){throw"Unimplemented method enable()";},cancel:function(){throw"Unimplemented method cancel()";},setValue:function(){throw"Unimplemented method setValue()";},getValue:function(){throw"Unimplemented method getValue()";},getFilename:function(){throw"Unimplemented method getFilename()";
}};PandaUploader.BaseStrategy=function(){};
PandaUploader.BaseStrategy.prototype={setUploadWidget:function(a){this.widget=a},init:function(){return!0},onwidgetload:function(){},onchange:function(){},onloadstart:function(){this.widget.options.progress_handler.reset();this.widget.options.progress_handler&&this.widget.options.progress_handler.start(this.widget.getFile())},onprogress:function(a){try{PandaUploader.log("onprogress event: loaded: ",a.loaded,", total: ",a.total),this.widget.options.progress_handler&&this.widget.options.progress_handler.setProgress(this.widget.getFile(),
a.loaded,a.total)}catch(b){}},onload:function(){},onerror:function(){this.widget.options.progress_handler.reset()},onabort:function(){this.widget.enable();this.widget.options.progress_handler.reset()}};PandaUploader.UploadOnSubmit=function(){var a=arguments[0];this.disable_submit_button=!0;if(a&&typeof a.disable_submit_button!="undefined")this.disable_submit_button=a.disable_submit_button;PandaUploader.BaseStrategy.apply(this,arguments)};PandaUploader.UploadOnSubmit.prototype=new PandaUploader.BaseStrategy;
PandaUploader.UploadOnSubmit.prototype.constructor=PandaUploader.UploadOnSubmit;
PandaUploader.UploadOnSubmit.prototype.init=function(){var a=this.widget.query.parents("form")[0];if(!a)return PandaUploader.alert("Could not find a suitable form. Please place the call to pandaUploader() after the form, or to be executed onload()."),!1;return jQuery(a).find("[name=submit], #submit").length!=0?(PandaUploader.alert('An element of your video upload form is incorrect (most probably the submit button). Neither NAME nor ID can be set to "submit" on any field.'),!1):PandaUploader.BaseStrategy.prototype.init.apply(this,
arguments)};PandaUploader.UploadOnSubmit.prototype.disableSubmitButton=function(){jQuery(this.getSubmitButton()).attr("disabled",!0)};PandaUploader.UploadOnSubmit.prototype.enableSubmitButton=function(){return jQuery(this.getSubmitButton()).removeAttr("disabled")};PandaUploader.UploadOnSubmit.prototype.getSubmitButton=function(){return jQuery(this.getForm()).find("input[type=submit]")};PandaUploader.UploadOnSubmit.prototype.getForm=function(){return this.widget.query.parents("form").get(0)};
PandaUploader.UploadOnSubmit.prototype.onchange=function(){this.enableSubmitButton()};PandaUploader.UploadOnSubmit.prototype.onwidgetload=function(){if(this.widget){var a=this.getForm();a&&(jQuery(a).submit(PandaUploader.bind(this,"onsubmit")),this.disable_submit_button&&this.disableSubmitButton())}};PandaUploader.UploadOnSubmit.prototype.onloadstart=function(){this.widget.disable();this.disableSubmitButton();PandaUploader.BaseStrategy.prototype.onloadstart.apply(this)};
PandaUploader.UploadOnSubmit.prototype.onsuccess=function(){this.getForm().submit()};PandaUploader.UploadOnSubmit.prototype.onabort=function(){PandaUploader.BaseStrategy.prototype.onabort.apply(this);this.widget.options.disableSubmitButton&&this.disableSubmitButton()};PandaUploader.UploadOnSubmit.prototype.onsubmit=function(){return this.widget.triggerUserEvent("onsubmit")!=!1?this.widget.getFile()?(this.widget.start(),!1):!0:!1};PandaUploader.UploadOnSelect=function(){};
PandaUploader.UploadOnSelect.prototype=new PandaUploader.BaseStrategy;PandaUploader.UploadOnSelect.prototype.constructor=PandaUploader.UploadOnSelect;PandaUploader.UploadOnSelect.prototype.onchange=function(){this.widget.start()};PandaUploader.FlashWidget=function(a){a=typeof a=="undefined"?{}:a;this.add_filename_field=!0;if(typeof a.add_filename_field!="undefined")this.add_filename_field=a.add_filename_field;this.swfupload_options=a===void 0?{}:a};PandaUploader.FlashWidget.prototype=new PandaUploader.BaseWidget;
PandaUploader.FlashWidget.prototype.constructor=PandaUploader.FlashWidget;
PandaUploader.FlashWidget.prototype.init=function(){PandaUploader.BaseWidget.prototype.init.apply(this,arguments);var a=this.query.attr("id"),b=a+"_pandauploader-flashwidget-placeholder";this.filename_field_id=a+"_orig-filename";this.query.after('<span id="'+b+'"></span>');this.add_filename_field&&jQuery("#"+b).after('<input type="text" style="position: relative; top: -8px; margin-left: .5em;" disabled="disabled" id="'+this.filename_field_id+'" />');this.swfupload=this.query.swfupload(jQuery.extend({upload_url:this.options.api_url+
"/videos.json",file_size_limit:PandaUploader.sizeInBytes(this.options.file_size_limit),file_types:this.allowedFileTypes(),file_types_description:"All Files",file_upload_limit:0,flash_url:this.options.uploader_dir+"/assets/swfupload.swf",button_image_url:this.options.uploader_dir+"/assets/choose_file_button.png",button_width:87,button_height:27,button_placeholder_id:b,file_post_name:"file",debug:!1},this.swfupload_options));this.swfupload.bind("swfuploadLoaded",this.boundHandler("onwidgetload"));this.swfupload.bind("fileQueued",
PandaUploader.bind(this,"fileQueued"));this.swfupload.bind("fileQueueError",PandaUploader.bind(this,"fileQueueError"));this.swfupload.bind("uploadStart",PandaUploader.bind(this,"uploadStart"));this.swfupload.bind("uploadProgress",PandaUploader.bind(this,"uploadProgress"));this.swfupload.bind("uploadSuccess",PandaUploader.bind(this,"uploadSuccess"));this.swfupload.bind("uploadError",PandaUploader.bind(this,"uploadError"))};
PandaUploader.FlashWidget.prototype.fileQueued=function(a,b){this.file=b;jQuery("#"+this.filename_field_id).val(b.name);this.triggerEvent("onchange")};PandaUploader.FlashWidget.prototype.uploadStart=function(a){PandaUploader.log("Flash widget: start event: file ",a.name);this.swfupload.data("__swfu").setPostParams(this.getSignedParams());this.triggerEvent("onloadstart")};PandaUploader.FlashWidget.prototype.uploadProgress=function(a,b,c,d){a.loaded=c;a.total=d;this.triggerEvent("onprogress",[a])};
PandaUploader.FlashWidget.prototype.uploadSuccess=function(a,b,c){this.setValue(PandaUploader.parseJSON(c).id);PandaUploader.log("Flash widget: success event: status ",200);PandaUploader.log("Flash widget: success event: response ",c);a={target:{status:"200",responseText:c}};this.triggerEvent("onreadystatechange",[a]);this.triggerEvent("onsuccess",[a])};
PandaUploader.FlashWidget.prototype.uploadError=function(a,b,c,d){this.triggerEvent("onerror",[function(){var a=PandaUploader.getHttpStatusText(d),b=PandaUploader.getPandaError(d);return{target:{status:d,statusText:a,responseText:'{"message":"'+a+'",error:"'+b+'"}'}}}(a,d),{name:b.name,size:b.size,type:b.type}]);PandaUploader.log("Flash widget: error event: status ",d);PandaUploader.log("Flash widget: error event: response unavailable with flash")};
PandaUploader.FlashWidget.prototype.fileQueueError=function(a,b,c,d){d=="File size exceeds allowed limit."?PandaUploader.alert("The file you are trying to upload is too large. The limit is "+this.options.file_size_limit):PandaUploader.alert("Uploader error: "+d)};PandaUploader.FlashWidget.prototype.getFile=function(){return this.file};PandaUploader.FlashWidget.prototype.start=function(){return this.swfupload.swfupload("startUpload")};
PandaUploader.FlashWidget.prototype.disable=function(){return this.swfupload.swfupload("setButtonDisabled",!0)};PandaUploader.FlashWidget.prototype.enable=function(){return this.swfupload.swfupload("setButtonDisabled",!1)};PandaUploader.FlashWidget.prototype.abort=function(){this.swfupload.swfupload("cancelUpload","",!1);this.add_filename_field&&jQuery("#"+this.filename_field_id).val("");PandaUploader.log("Flash widget: abort event");this.triggerEvent("onabort")};
PandaUploader.FlashWidget.prototype.setValue=function(a){return this.swfupload.val(a)};PandaUploader.FlashWidget.prototype.getValue=function(){return this.swfupload.val()};PandaUploader.FlashWidget.prototype.getFilename=function(){return this.file?this.file.name:null};PandaUploader.FlashWidget.prototype.allowedFileTypes=function(){return!this.options.allowed_extensions?"*.*":jQuery.map(this.options.allowed_extensions,function(a){return"*."+a}).join(";")};PandaUploader.HTML5Widget=function(){};
PandaUploader.HTML5Widget.prototype=new PandaUploader.BaseWidget;PandaUploader.HTML5Widget.prototype.constructor=PandaUploader.HTML5Widget;
PandaUploader.HTML5Widget.prototype.init=function(){PandaUploader.BaseWidget.prototype.init.apply(this,arguments);this.xhr=PandaUploader.createXHRObject();this.xhr.upload.addEventListener("loadstart",this.boundHandler("onloadstart"),!1);this.xhr.upload.addEventListener("progress",this.boundHandler("onprogress"),!1);this.xhr.upload.addEventListener("load",this.boundHandler("onload"),!1);this.xhr.upload.addEventListener("error",PandaUploader.bind(this,"onerror"),!1);this.xhr.upload.addEventListener("abort",
this.boundHandler("onabort"),!1);this.createField();this.triggerEvent("onwidgetload")};
PandaUploader.HTML5Widget.prototype.start=function(){var a=this.getFile(),b=this.getSignedParams(),c=new FormData,d;for(d in b)c.append(d,b[d]);c.append("file",a);this.xhr.open("POST",this.options.api_url+"/videos.json",!0);this.xhr.setRequestHeader("Cache-Control","no-cache");this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");this.bindRSCEvent();this.errorCalled=!1;PandaUploader.log("HTML5 widget: start event: file ",a.name||a.fileName);PandaUploader.log("Using W3C API");this.xhr.send(c)};
PandaUploader.HTML5Widget.prototype.abort=function(){PandaUploader.log("HTML5 widget: abort event");$(this.getField()).remove();this.createField();this.xhr.abort()};PandaUploader.HTML5Widget.prototype.getFile=function(){return jQuery(this.getField()).get(0).files[0]};PandaUploader.HTML5Widget.prototype.setValue=function(a){return this.query.val(a)};PandaUploader.HTML5Widget.prototype.disable=function(){jQuery(this.getField()).attr("disabled",!0)};PandaUploader.HTML5Widget.prototype.enable=function(){jQuery(this.getField()).removeAttr("disabled")};
PandaUploader.HTML5Widget.prototype.createField=function(){this.query.after('<input type="file" />');jQuery(this.getField()).change(PandaUploader.bind(this,"onchange"))};PandaUploader.HTML5Widget.prototype.getField=function(){return this.query.next().get(0)};PandaUploader.HTML5Widget.prototype.getFilename=function(){var a=this.getFile();return a?a.name||a.fileName:null};PandaUploader.HTML5Widget.prototype.onerror=function(a){PandaUploader.log("HTML5 widget: onerror event: ",a);this.notifyError(a)};
PandaUploader.HTML5Widget.prototype.notifyError=function(a){if(!this.errorCalled)this.errorCalled=!0,this.triggerEvent("onerror",[a,this.getFile()])};
PandaUploader.HTML5Widget.prototype.onreadystatechange=function(a){this.triggerEvent("onreadystatechange",arguments);var b=null;try{b=a.target.status}catch(c){this.bindRSCEvent();return}b=="200"&&!a.target.responseText?PandaUploader.log("HTML5 widget: onreadystatechange event: cors request status",b):(PandaUploader.log("HTML5 widget: onreadystatechange event: status",b),PandaUploader.log("HTML5 widget: onreadystatechange event: response: ",a.target.responseText));b=="200"&&a.target.responseText?(this.setValue(PandaUploader.parseJSON(a.target.responseText).id),
this.triggerEvent("onsuccess",[a])):(b!="200"&&this.notifyError(a),this.bindRSCEvent())};PandaUploader.HTML5Widget.prototype.bindRSCEvent=function(){jQuery(this.xhr).one("readystatechange",PandaUploader.bind(this,"onreadystatechange"))};PandaUploader.HTML5Widget.prototype.onchange=function(){this.validateFileExtension()&&this.validateFileSize()?this.triggerEvent("onchange"):(this.query.next("[type=file]").remove(),this.createField())};
PandaUploader.HTML5Widget.prototype.validateFileExtension=function(){var a=!1,b=this.getFile().fileName||this.getFile().name;jQuery.each(this.options.allowed_extensions,function(c,d){RegExp("\\."+d+"$","i").test(b)&&(a=!0)});a||PandaUploader.alert("You did not select a video file. Please select a valid file.");return a};
PandaUploader.HTML5Widget.prototype.validateFileSize=function(){var a=this.getFile().size||this.getFile().fileSize,b=PandaUploader.sizeInBytes(this.options.file_size_limit);return b&&a>b?(PandaUploader.alert("The file you are trying to upload is too large. The limit is "+this.options.file_size_limit),!1):!0};PandaUploader.SmartWidget=function(a,b){return PandaUploader.supportHTML5Widget()?new PandaUploader.HTML5Widget(a):new PandaUploader.FlashWidget(b)};
(function(){function a(a){this.options=a;this.$p=jQuery("#"+this.options.upload_progress_id);this.$p.css({display:"none",width:"250px",height:"26px",border:"1px solid #0c3c7e",background:"url("+this.options.uploader_dir+"/assets/progress_bg.gif) repeat scroll left top"});this.fileSize=this.count=0}jQuery.fn.checkPandaUploaderOptions=function(a){if(a===void 0)return PandaUploader.alert("There was an error setting up the upload form. (The upload parameters were not specified)."),!1;return this.size()==
0?(PandaUploader.alert("The jQuery element is empty. Method pandaUploader() cannot be executed"),!1):!0};jQuery.fn.pandaUploader=function(b,c){c=c===void 0?{}:c;if(!this.checkPandaUploaderOptions(b,c))return!1;c=jQuery.extend({upload_progress_id:null,api_host:"api.pandastream.com",progress_handler:null,uploader_dir:PandaUploader.uploader_dir,upload_strategy:null,widget:null,file_size_limit:"5GB",allowed_extensions:"3g2,3gp,asf,asx,avi,bdm,bsf,cpi,divx,dmsm,dream,dvdmedia,dvr-ms,f4v,fbr,flv,hdmov,m2p,m4v,mkv,mod,moi,mov,mp4,mpeg,mpg,mts,mxf,ogm,psh,rm,rmvb,scm,smil,srt,stx,swf,tix,trp,ts,vob,vro,wmv,wtv,xvid,yuv,webm,ogg,ogv".split(",")},
c);c.api_url=c.api_url||document.location.protocol+"//"+c.api_host+"/v2";if(!c.progress_handler)c.progress_handler=new a(c);var d=c.widget;d||(d=new PandaUploader.SmartWidget);if(!c.upload_strategy)c.upload_strategy=new PandaUploader.UploadOnSubmit;c.upload_strategy.setUploadWidget(d);d.init(this,b,c);(d=jQuery("#"+c.upload_cancel_button_id))&&d.click(PandaUploader.bind(this.upload_strategy,"onCancel"));PandaUploader.hasFirefox(3.5)&&window.console&&window.console.firebug&&alert("Unexpected behaviour may happen if Firebug is enabled. Please disable Firebug to use the video uploader");
return this};a.prototype={start:function(a){this.count=0;if(this.$p.size()!=0){this.$p.find(".progress-inside").size()==0&&this.$p.append('<div class="progress-inside"></div>');this.progress=this.$p.find(".progress-inside");this.progress.css({height:"100%",backgroundImage:"url("+this.options.uploader_dir+"/assets/progress_fg.gif)"});this.fileSize=a.size;this.setProgress(a,0,this.fileSize);this.$p.css("display","block");var c=this;this.timer=setInterval(function(){c.animateBarBg()},30)}},setProgress:function(a,
c){if(this.progress){var d=Math.ceil(c*100/this.fileSize);d>100&&(d=100);jQuery(this.progress).css("width",d+"%")}},animateBarBg:function(){this.count++;if(this.count==37)this.count=0;this.$p.css("background-position",this.count+"px 0px")},reset:function(){clearInterval(this.timer);jQuery(this.progress).css("width","0%");this.$p.css("display","none")}}})();
